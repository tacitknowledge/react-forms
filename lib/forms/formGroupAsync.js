'use strict';var _createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,'value'in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_lodash=require('lodash');Object.defineProperty(exports,'__esModule',{value:!0});function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}function flattenObj(a){return Object.keys(a).map(function(b){return a[b]}).reduce(function(a,b){return Object.assign({},a,b)},{})}var FormGroupAsync=function(){function a(b){var c=b.formName,d=b.groups;_classCallCheck(this,a),this.formName=c,this.groups=[].concat(_toConsumableArray(d)),this.resolve=this.resolve.bind(this),this.reject=this.reject.bind(this),this.generatePromises=this.generatePromises.bind(this),this.successCallbacks=[],this.failCallbacks=[],this.resolvedMemo={},this.generatePromises()}return _createClass(a,[{key:'generatePromises',value:function generatePromises(){var a=this;this.successCallbacks=[],this.failCallbacks=[],this.resolvers={},this.rejecters={},this.handlePromises(this.getNames().map(function(b){return a.resolvedMemo[b]?Promise.resolve(a.resolvedMemo[b]):new Promise(function(c,d){a.resolvers[b]=c,a.rejecters[b]=d})}))}},{key:'handlePromises',value:function handlePromises(a){var b=this;Promise.all(a).then(function(){b.successCallbacks[0]&&b.successCallbacks.forEach(function(a){return a(flattenObj(b.resolvedMemo))}),b.resolvedMemo={}}).catch(function(a){b.failCallbacks[0]&&b.failCallbacks.forEach(function(b){return b(a)})}).then(this.generatePromises)}},{key:'resolve',value:function resolve(a,b){return this.resolvers[b]&&this.resolvers[b](a),this.resolvedMemo[b]=a,this}},{key:'reject',value:function reject(a,b){return this.rejecters[b]&&this.rejecters[b](a),this.resolvedMemo[b]=null,this}},{key:'getRootName',value:function getRootName(){return''+this.formName}},{key:'getName',value:function getName(a){if(!(0,_lodash.includes)(this.groups,a))throw new Error(a+' group is not found in '+this.formName+' groups. Did you mispell it?');return this.formName+'-'+a}},{key:'getNames',value:function getNames(){var a=this;return this.groups.map(function(b){return a.getName(b)})}},{key:'each',value:function each(a){return this.getNames().forEach(a),this}},{key:'then',value:function then(a){var b=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return b?this.successCallbacks=[a.bind(this)]:this.successCallbacks.push(a.bind(this)),this}},{key:'fail',value:function fail(a){var b=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return b?this.failCallbacks=[a.bind(this)]:this.failCallbacks.push(a.bind(this)),this}}]),a}();exports.default=FormGroupAsync;